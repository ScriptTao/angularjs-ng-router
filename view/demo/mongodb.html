<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>mongodb</title>

    <link rel="stylesheet" href="../../bootstrap-3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../DataTables/DataTables-1.10.16/css/jquery.dataTables.css">
    <link rel="stylesheet" href="../../highlight/styles/rainbow.css">
    <link rel="stylesheet" href="../../css/ustb.css">

    <style type="text/css">
        .well button {
            margin: 5px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="page-header">
        <h1>mongodb</h1>
    </div>

    <h3>基本使用方法</h3>
    <p>在html文档body底部引入javascript文件。请注意引入的文件路径</p>
    <pre><code class="html">
&lt;script src="../../jquery-3.2.1/jquery-3.2.1.min.js"&gt;&lt;/script&gt;
&lt;script src="../../bootstrap-3.3.7/js/bootstrap.min.js"&gt;&lt;/script&gt;
&lt;script src="../../DataTables/datatables.js"&gt;&lt;/script&gt;
&lt;script src="../../echarts/echarts-3.8.0.js"&gt;&lt;/script&gt;
&lt;script src="../../js/q.js""&gt;&lt;/script"&gt;
&lt;script src="../../js/ustb.js"&gt;&lt;/script&gt;
    </code></pre>

    <p>获取数据并显示在网页上，数据的返回格式请参考mongodb文档</p>
    <pre><code>
     $("#btnCount").click(function() {
        var data = {
            "collection": "ustb_test",

            // 查询条件：年龄大于1
            // $lt 为小于,  $gte 为大于等于，$lte为小于等于
            // 详细查询方法请查询mongodb文档
            "data": {
                "age": {
                    "$gt": 1
                }
            }
        };

        ustb.mongoCount(data, function(response){
            $("#result").html(JSON.stringify(response, null, 4));
        });
     });

     $("#btnCreateCollection").click(function() {
        var data = {
            "name": ustb.randomStr(5)
        };

        ustb.mongoCreateCollection(data, function(response){
            $("#result").html(JSON.stringify(response, null, 4));
        });
     });

     $("#btnDropCollection").click(function() {
        var data = {
            "name": "ustb_test"
         };

        ustb.mongoDropCollection(data, function(response){
            $("#result").html(JSON.stringify(response, null, 4));
        });
     });

     $("#btnListCollections").click(function() {
        ustb.mongoListCollections(function(response){
            $("#result").html(JSON.stringify(response, null, 4));
        });
     });

     $("#btnInsert").click(function() {
        var data = {
            "collection": "ustb_test",
            "data": {
                "name": ustb.randomStr(5),
                "age": Math.ceil(Math.random()*60)
            }
        };

        ustb.mongoInsert(data, function(response){
            $("#result").html(JSON.stringify(response, null, 4));
        });
     });

     $("#btnMultiInsert").click(function() {
        var data = {
            "collection": "ustb_test",

            // 与单独插入不同的是，此处提交的是数组
            "list": [
                {
                    "name": ustb.randomStr(5),
                    "age": Math.ceil(Math.random() * 60)
                },
                {
                    "name": ustb.randomStr(5),
                    "age": Math.ceil(Math.random() * 60)
                }
            ]
        };

        ustb.mongoMultiInsert(data, function(response){
            $("#result").html(JSON.stringify(response, null, 4));
        });
     });

     $("#btnDeleteOne").click(function() {
        var data = {
            "collection": "ustb_test",
            "data": {
                "age": {
                    "$gt": 1
                }
            }
        };

        ustb.mongoDeleteOne(data, function(response){
            $("#result").html(JSON.stringify(response, null, 4));
        });
     });

     $("#btnDeleteMany").click(function() {
        var data = {
            "collection": "ustb_test",
            "data": {
                "age": {
                    "$gt": 1
                }
            }
        };

        ustb.mongoDeleteMany(data, function(response){
            $("#result").html(JSON.stringify(response, null, 4));
        });
     });

     $("#btnFind").click(function() {
        var data = {
            "collection": "ustb_test",

            // 查询条件：年龄大于1
            // $lt 为小于,  $gte 为大于等于，$lte为小于等于
            // 详细查询方法请查询mongodb文档
            "data": {
                "age": {
                    "$gt": 1
                }
            }
         };

        ustb.mongoFind(data, function(response){
            $("#result").html(JSON.stringify(response, null, 4));
        });
     });
    </code></pre>

    <div class="well">
        <button id="btnCount" class="btn btn-primary btn-lg">查询记录条数</button>
        <button id="btnCreateCollection" class="btn btn-primary btn-lg">创建记录集</button>
        <button id="btnDropCollection" class="btn btn-primary btn-lg">删除记录集</button>
        <button id="btnListCollections" class="btn btn-primary btn-lg">列出所有记录集</button>
        <button id="btnInsert" class="btn btn-primary btn-lg">插入数据</button>
        <button id="btnMultiInsert" class="btn btn-primary btn-lg">插入多条记录</button>
        <button id="btnDeleteOne" class="btn btn-primary btn-lg">删除单条记录</button>
        <button id="btnDeleteMany" class="btn btn-primary btn-lg">删除多条记录</button>
        <button id="btnFind" class="btn btn-primary btn-lg">查找</button>
    </div>

    <pre><code id="result">
    </code></pre>

    <table class="table table-stripped">
        <thead>
        <tr>
            <td>字段</td>
            <td>类型</td>
            <td>含义</td>
            <td>备注</td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>code</td>
            <td>int</td>
            <td>错误码</td>
            <td>请参考错误码表</td>
        </tr>
        <tr>
            <td>msg</td>
            <td>string</td>
            <td>错误信息</td>
            <td>与错误码对应的错误信息</td>
        </tr>
        <tr>
            <td>extraMsg</td>
            <td>string</td>
            <td>额外的错误信息</td>
            <td>通常情况下，额外的错误信息更有用</td>
        </tr>
        <tr>
            <td>data</td>
            <td>未知</td>
            <td>本次请求返回的数据</td>
            <td>数据类型依据接口而定</td>
        </tr>
        </tbody>
    </table>

    <p>
        返回数据为json数据，其中包含了错误码和错误信息字段。可以使用以下方法判断调用是否成功并取得错误码：
    </p>

    <pre><code>
    ustb.success(response)  // 成功则返回true，失败则返回false
    ustb.getErrorMessage(response) // 首先获取extraMsg，如果extraMsg为空，则获取msg
    </code></pre>

    <p>本接口返回的数据格式请参考mongodb文档</p>

    <div style="height:300px;"></div>
</div>
</body>

<script src="../../jquery-3.2.1/jquery-3.2.1.min.js"></script>
<script src="../../bootstrap-3.3.7/js/bootstrap.min.js"></script>
<script src="../../highlight/highlight.pack.js"></script>
<script src="../../echarts/echarts-3.8.0.js"></script>
<script src="../../js/q.js"></script>
<script src="../../js/ustb.js"></script>

<script language="JavaScript">
    hljs.initHighlightingOnLoad();

    $(document).ready(function () {
        $("#btnCount").click(function() {
            var data = {
                "collection": "ustb_test",

                // 查询条件：年龄大于1
                // $lt 为小于,  $gte 为大于等于，$lte为小于等于
                // 详细查询方法请查询mongodb文档
                "data": {
                    "age": {
                        "$gt": 1
                    }
                }
            };

            ustb.mongoCount(data, function(response){
                $("#result").html(JSON.stringify(response, null, 4));
                hljs.highlightBlock($("#result").get(0));
            });
        });
        $("#btnCreateCollection").click(function() {
            var data = {
                "name": ustb.randomStr(5)
            };

            ustb.mongoCreateCollection(data, function(response){
                $("#result").html(JSON.stringify(response, null, 4));
                hljs.highlightBlock($("#result").get(0));
            });
        });
        $("#btnDropCollection").click(function() {
            var data = {
                "name": "ustb_test"
            };

            ustb.mongoDropCollection(data, function(response){
                $("#result").html(JSON.stringify(response, null, 4));
                hljs.highlightBlock($("#result").get(0));
            });
        });
        $("#btnListCollections").click(function() {
            ustb.mongoListCollections(function(response){
                $("#result").html(JSON.stringify(response, null, 4));
                hljs.highlightBlock($("#result").get(0));
            });
        });
        $("#btnInsert").click(function() {
            var data = {
                "collection": "ustb_test",
                "data": {
                    "name": ustb.randomStr(5),
                    "age": Math.ceil(Math.random()*60)
                }
            };

            ustb.mongoInsert(data, function(response){
                $("#result").html(JSON.stringify(response, null, 4));
                hljs.highlightBlock($("#result").get(0));
            });
        });
        $("#btnMultiInsert").click(function() {
            var data = {
                "collection": "ustb_test",

                // 与单独插入不同的是，此处提交的是数组
                "list": [
                    {
                        "name": ustb.randomStr(5),
                        "age": Math.ceil(Math.random() * 60)
                    },
                    {
                        "name": ustb.randomStr(5),
                        "age": Math.ceil(Math.random() * 60)
                    }
                ]
            };

            ustb.mongoMultiInsert(data, function(response){
                $("#result").html(JSON.stringify(response, null, 4));
                hljs.highlightBlock($("#result").get(0));
            });
        });

        $("#btnDeleteOne").click(function() {
            var data = {
                "collection": "ustb_test",
                "data": {
                    "age": {
                        "$gt": 1
                    }
                }
            };

            ustb.mongoDeleteOne(data, function(response){
                $("#result").html(JSON.stringify(response, null, 4));
                hljs.highlightBlock($("#result").get(0));
            });
        });
        $("#btnDeleteMany").click(function() {
            var data = {
                "collection": "ustb_test",
                "data": {
                    "age": {
                        "$gt": 1
                    }
                }
            };

            ustb.mongoDeleteMany(data, function(response){
                $("#result").html(JSON.stringify(response, null, 4));
                hljs.highlightBlock($("#result").get(0));
            });
        });
        $("#btnFind").click(function() {
            var data = {
                "collection": "ustb_test",

                // 查询条件：年龄大于1
                // $lt 为小于,  $gte 为大于等于，$lte为小于等于
                // 详细查询方法请查询mongodb文档
                "data": {
                    "age": {
                        "$gt": 1
                    }
                }
            };

            ustb.mongoFind(data, function(response){
                $("#result").html(JSON.stringify(response, null, 4));
                hljs.highlightBlock($("#result").get(0));
            });
        });
    });

</script>
</html>